---
layout:     post
title: 	    "Basic Network Testing with IPERF"
post_author:	    
post_date:	    Mon, 10 Nov 2014 00:43:00 +0000
post_site:	    xenserver.org 
post_link:	    http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html
---
<html><body><div><div class="blog-text clearfix prel mtm mbm">&#13;
&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			<h2>Purpose</h2>&#13;
<p>I am often asked how one can perform <strong>simple </strong>network testing within, outside, and into XenServer.  This is a great question as – by itself – it is simple enough to answer.  However, depending on what one desires out of “network testing” the answer can quickly become more complex.</p>&#13;
<p>As such, this I have decided to answer this question using a long standing, free utility called IPERF (well, IPERF2).  It is a rather simple, straight-forward, but powerful utility I have used over many, many years.  Links to IPERF will be provided - along with documentation on its use - as it will serve in this guide as a way to:</p>&#13;
<p><br/>- Test bandwidth between two or more points</p>&#13;
<p>- Determine bottlenecks</p>&#13;
<p>- Assists with black box testing or “what happens if” scenarios</p>&#13;
<p>- Use a tool that runs on both Linux and Windows</p>&#13;
<p>- And more…</p>&#13;
<h2>IPERF: A Visual Breakdown</h2>&#13;
<p>IPERF has to be installed on/at at least two separate end points.  One point acts a server/receiver and the other point acts as a client/transmitter.  This so network testing can be done on a simple subnet to a complex, routed network: end-to-end using TCP or UDP generated traffic:</p>&#13;
<p><img src="http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html" border="0" alt=""/></p>&#13;
<p>The visual shows an IPERF client transmitting data over IPv4 to an IPERF receiver.  Packets traverse the network - from wireless routers and through firewalls - from the client side to the server side to over port 5001.</p>&#13;
<h2>IPERF and XenServer</h2>&#13;
<p>The key to network testing is in remembering that any device which is connected to a network infrastructure – Virtual or Physical – is a node, host, target, end point, or just simply … a <em>networked device</em>.<br/><br/>With regards to virtual machines, XenServer obviously supports Windows and Linux operating systems.  IPERF can be used to test virtual-to-virtual networking as well as virtual-to-physical networking.  If we stack virtual machines in a box to our left and stack physical machines in a box to our right – despite a common subnet or routed network – we can quickly see the permutations of how "Virtual and Physical Network Testing" can be achieved with IPERF transmitting data from one point to another:</p>&#13;
<p><img src="http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html" border="0" alt=""/></p>&#13;
<p>And if one wanted, they could just as easily test networking for this:</p>&#13;
<p><img src="http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html" border="0" alt=""/></p>&#13;
<h2>Requirements</h2>&#13;
<p>To illustrate a basic server/client model with IPERF, the following will be required:</p>&#13;
<p>- A Windows 7 VM that will act as an IPERF client</p>&#13;
<p>- A CentOS 5.x VM that will act as a receiver.</p>&#13;
<p>- IPERF2 (the latest version of IPERF, or "IPERF3" can be found at <a href="https://github.com/esnet/iperf" target="_blank" title="IPERF3">https://github.com/esnet/iperf</a> or, more specifically, <a href="http://downloads.es.net/pub/iperf/" target="_blank" title="IPERF3 DOWNLOAD">http://downloads.es.net/pub/iperf/</a>)</p>&#13;
<p><span>The reason for using IPERF2 is quite simple: portability and compatibility on two of the most popular operating systems that I know are virtualized.  In addition, the same steps to installing IPERF2 on these hosts can be carried out on physical systems running similar operating systems, as well. </span></p>&#13;
<p><span>The remainder of this article - regarding IPERF2 - will require use of the MS-DOS command-line as well as the Linux shell (of choice).  I will carefully explain all commands as so if you are “strictly a GUI” person, you should fit right in.</span></p>&#13;
<p><span>Disclaimer</span></p>&#13;
<p>When utilizing IPERF2, keep in mind that this <strong>is</strong> a traffic generator.  While one can control the quantity and duration of traffic, it is still <em>network traffic</em>! </p>&#13;
<p>So, consider testing during non-peak hours or after hours as to not interfere with production-based network activity.</p>&#13;
<p><span>Windows and IPERF</span></p>&#13;
<p><span>The Windows port of IPERF 2.0.5 requires Windows XP (or greater) and can be downloaded from:</span></p>&#13;
<p><a href="http://sourceforge.net/p/iperf/patches/_discuss/thread/20d4a4b0/5c44/attachment/Iperf.zip" target="_blank" title="IPERF2 FOR WINDOWS">http://sourceforge.net/p/iperf/patches/_discuss/thread/20d4a4b0/5c44/attachment/Iperf.zip</a></p>&#13;
<p><span>Within the .zip file you will find two directories.  One is labeled DEBUG and the other is labeled RELEASE.  Export the Iperf.exe program to a directory you will remember, such as C:\iperf\</span></p>&#13;
<p><img src="http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html" border="0" alt=""/></p>&#13;
<p>Now, accessing the command line (cmd.exe), navigate to C:\iperf\ and execute:</p>&#13;
<pre>iperf</pre>&#13;
<p><span>The following output should appear:</span></p>&#13;
<p><img src="http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html" border="0" alt=""/></p>&#13;
<h2>Linux and IPERF</h2>&#13;
<p>If you have additional repos already configured for CentOS, you can simply execute (as root):</p>&#13;
<pre>yum install iperf</pre>&#13;
<p><span>If that fails, one will need to download the Fedora/RedHat EPEL-Release RPM file for the version of CentOS being used.  To do this (as root), execute:</span></p>&#13;
<pre>wget  http://dl.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm</pre>&#13;
<pre>rpm -Uvh epel-release-5-4.noarch.rpm</pre>&#13;
<p> </p>&#13;
<p><strong>*** Note that the above EPEL-Release RPM file is just an example (a working one) ***</strong><em><br/></em></p>&#13;
<p> </p>&#13;
<p>Once epel-release-5-4.noarch.rpm is installed, execute:</p>&#13;
<pre>yum install iperf</pre>&#13;
<p>And once complete, as root execute iperf and one should see the following output:</p>&#13;
<p><img class="decoded" src="http://cdn.ws.citrix.com/wp-content/uploads/2014/06/CMD2.png?__utma=222274247.1078613845.1409810797.1412210514.1412210784.2&amp;__utmb=222274247.5.8.1412227628611&amp;__utmc=222274247&amp;__utmx=-&amp;__utmz=222274247.1412210514.1.1.utmcsr=%28direct%29%7Cutmccn=%28direct%29%7Cutmcmd=%28none%29&amp;__utmv=222274247.%7C1=my%20account%20holder=y=1%5E14=industry=%28Non-company%20Visitor%29=1%5E15=sub_industry=%28Non-company%20Visitor%29=1%5E16=employee_count=%28Non-company%20Visitor%29=1%5E17=company_name=%28Non-company%20Visitor%29=1%5E18=primary_sic=%28Non-company%20Visitor%29=1%5E19=registry_dma_code=%28Non-company%20Visitor%29=1&amp;__utmk=208580497" border="0" alt="http://cdn.ws.citrix.com/wp-content/uploads/2014/06/CMD2.png?__utma=222274247.1078613845.1409810797.1412210514.1412210784.2&amp;__utmb=222274247.5.8.1412227628611&amp;__utmc=222274247&amp;__utmx=-&amp;__utmz=222274247.1412210514.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)&amp;__utmv=222274247.|1=my%20account%20holder=y=1^14=industry=(Non-company%20Visitor)=1^15=sub_industry=(Non-company%20Visitor)=1^16=employee_count=(Non-company%20Visitor)=1^17=company_name=(Non-company%20Visitor)=1^18=primary_sic=(Non-company%20Visitor)=1^19=registry_dma_code=(Non-company%20Visitor)=1&amp;__utmk=208580497"/></p>&#13;
<p>Notice that it is the same output as what is being displayed from Windows.  IPERF2 is expecting a "-s" (server) or "-c" (client) command-line option with additional arguments.</p>&#13;
<h2>IPERF Command-Line Arguments</h2>&#13;
<p>On either Windows or Linux, a complete list of options for IPERF2 can be listed by executing:</p>&#13;
<pre>iperf –help</pre>&#13;
<p>A few good resources of examples to use IPERF2 options for the server or client can be referenced at:</p>&#13;
<p><a href="http://www.slashroot.in/iperf-how-test-network-speedperformancebandwidth" target="_blank">http://www.slashroot.in/iperf-how-test-network-speedperformancebandwidth</a></p>&#13;
<p><a href="http://samkear.com/networking/iperf-commands-network-troubleshooting" target="_blank">http://samkear.com/networking/iperf-commands-network-troubleshooting</a></p>&#13;
<p><a href="http://www.techrepublic.com/blog/data-center/handy-iperf-commands-for-quick-network-testing/" target="_blank">http://www.techrepublic.com/blog/data-center/handy-iperf-commands-for-quick-network-testing/</a></p>&#13;
<p>For now, we will focus on the options needed for our server and client:</p>&#13;
<pre>-f, –format    [kmKM]   format to report: Kbits, Mbits, KBytes, MBytes</pre>&#13;
<pre>-m, –print_mss          print TCP maximum segment size (MTU – TCP/IP header)</pre>&#13;
<pre>-i, –interval  #        seconds between periodic bandwidth reports</pre>&#13;
<pre>-s, –server             run in server mode</pre>&#13;
<pre>-c, –client    &lt;host&gt;   run in client mode, connecting to &lt;host&gt;</pre>&#13;
<pre>-t, –time      #        time in seconds to transmit for (default 10 secs)</pre>&#13;
<p>Lastly, there is a TCP/IP Window setting.  This goes beyond the scope of this document as it relates to the TCP frame/windowing of data.  I highly recommend reading either of the two following links – especially for Linux – as there has always been some debate as what is “best to be used”:</p>&#13;
<p><a href="https://kb.doit.wisc.edu/wiscnet/page.php?id=11779" target="_blank">https://kb.doit.wisc.edu/wiscnet/page.php?id=11779</a></p>&#13;
<p><a href="http://kb.pert.geant.net/PERTKB/IperfTool" target="_blank">http://kb.pert.geant.net/PERTKB/IperfTool</a></p>&#13;
<h2>Running An IPERF Test</h2>&#13;
<p><span>So, we have IPERF2 installed on Windows 7 and on CentOS 5.10.  Before one performs any testing, ensure any AV does not block iperf.exe from running as well as port 5001 being opened </span><strong>across</strong><span> the network network.</span></p>&#13;
<p>Again, another port can be specified, but the default port IPERF2 uses for both client and server is 5001.</p>&#13;
<h3><strong>Server/Receiver Side</strong></h3>&#13;
<p>The Server/Receiver side will be on the CentOS VM.</p>&#13;
<p>Following the commands above, we want to execute the following to run IPERF2 as a server/receiver from our Windows 7 client machine:</p>&#13;
<pre>iperf -s -f M -m -i 10</pre>&#13;
<p>The output should show:</p>&#13;
<pre>————————————————————<br/>Server listening on TCP port 5001<br/>TCP window size: 0.08 MByte (default)<br/>————————————————————</pre>&#13;
<p>The TCP window size has been previously commented on and the server is now ready to accept connections (press Control+C or Control+Z to exit).</p>&#13;
<h3><strong>Client/Transmission Side</strong></h3>&#13;
<p>Let us now focus on the client side to start sending data from the Windows 7 VM to the CentOS VM.</p>&#13;
<p>From Windows 7, the command line to start transmitting data for 30 seconds to our CentOS host (x.x.x.48) is:</p>&#13;
<pre>iperf -c x.x.x.48 -t 30 -f M</pre>&#13;
<p>Pressing enter, the traffic flow begins and the output from the client side looks like this:</p>&#13;
<p><img src="http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html" border="0" alt=""/></p>&#13;
<p>From the server side, the output looks something like this:</p>&#13;
<p><img src="http://xenserver.org/blog/entry/basic-network-testing-with-iperf.html" border="0" alt=""/></p>&#13;
<p>And there we have it – a first successful test from a Windows 7 VM (located on one XenServer) to a CentOS 5.10 VM (located on another XenServer).</p>&#13;
<h2>Understanding the Results</h2>&#13;
<p>From either the client side or server side, results are shown by time and average.  The key item to look for from either side is:</p>&#13;
<pre>0.0-30.0 sec  55828 MBytes  1861 MBytes/sec</pre>&#13;
<p>Why?  This shows the average over the course of 0.0 to 30.0 seconds in terms of <strong>total megabytes</strong> transmitted as well as average megabytes of data sent per second.  In addition, since the "-f M" argument was passed as a command-line option, the output is calculated in megabytes accordingly.</p>&#13;
<p>In this particular case, we simply illustrated that from one VM to another VM, we transferred data at 1861 megabytes per second.</p>&#13;
<p><strong>*** Note that this test was performed in a local lab with lower-end hardware than what you probably have! ***</strong></p>&#13;
<p>--jkbs | @xenfomation</p>&#13;
<p> </p>&#13;
			&#13;
			&#13;
										&#13;
			&#13;
					</div>&#13;
&#13;
		&#13;
					&#13;
			
</div></body></html>
