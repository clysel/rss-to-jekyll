---
layout:     post
title: 	    "Blog: Handling security incidents, automate or die"
post_author:	    Henrik Kramshøj
post_date:	    Tue, 03 Mar 2015 21:42:00 +0000
post_site:	    www.version2.dk 
post_link:	    http://www.version2.dk/blog/handling-security-incidents-automate-or-die-91461?utm_medium=feed&utm_source=version2.dk&utm_campaign=it_nyheder
---
<html><body><div><section class="body"><p>Jeg prøver at skrive indlægget her selvom jeg er træt, tilgiv mig hvis sproget er dårligt, ...</p>

<p>Jeg sidder i toget og læser om endnu en større alvorlig sikkerhedsfejl, <a href="http://blog.cryptographyengineering.com/2015/03/attack-of-week-freak-or-factoring-nsa.html">http://blog.cryptographyengineering.com/2015/03/attack-of-week-freak-or-...</a></p>

<p>Fantastisk arbejde og værd at læse, bagefter læser jeg nok <a href="http://www.washingtonpost.com/blogs/the-switch/wp/2015/03/03/freak-flaw-undermines-security-for-apple-and-google-users-researchers-discover/">http://www.washingtonpost.com/blogs/the-switch/wp/2015/03/03/freak-flaw-...</a></p>

<blockquote>
  <p>A group of cryptographers at INRIA, Microsoft Research and IMDEA have discovered some serious vulnerabilities in OpenSSL (e.g., Android) clients and Apple TLS/SSL clients (e.g., Safari) that allow a 'man in the middle attacker' to downgrade connections from 'strong' RSA to 'export-grade' RSA. These attacks are real and exploitable against a shocking number of websites -- including government websites. Patch soon and be careful.</p>
</blockquote>

<p>Specielt den sidste er som altid fantastisk - du skal patche, og det skal være nu. Blev vi forøvrigt færdig med den sidste alvorlige, altså den alvorlige lige før denne, som kom lige efter den anden megaalvorlige? Tidligere var mantraet patch or die, altså du skal patche systemerne for at være sikker. Problemet idag er dog at der ikke er timer nok. Du får knapt tid til at læse om den ene fejl, såbarhed eller patch før den næste står i døren.</p>

<p>Jeg kalder det kontinuert overlappende større security incidents. Du er nødt til at antage du har en security incident, indtil det er bekræftet eller afkræftet. Vi har set et væld af disse, og jeg lagde selv rigtigt mærke til det med Heartbleed at de kommer næsten uden ophold fra da til nu, og fremover.</p>

<h2>Patch cyklus</h2>

<p>Ser vi på den gængse patch cyklus, forsimplet en del:</p>

<p>1) Ny sårbarhed offentliggøres, OMFG, <em>panik</em>, die die die - FIRE in the machine room</p>

<p>2) Er der en patch? workaround? Findes et filter til vores loadbalancer, antivirus, IDS, detektion, loganalyse
Er vi overhovedet ramt? Hvad er sårbart, hvad version er sårbar, hvilke systemer, WTF-*</p>

<p>3) HEY GUYS VORES main site er ramt! Patch patch patch! Er der andre systemer som er sårbare? Hvordan finder vi resten?
- imorgen skal vi altså have styr på patches</p>

<p><em>sleep</em></p>

<p>4) HEY vi har flere sårbare systemer, og system X er hacket!</p>

<p><em>no sleep</em> days go by</p>

<p>5) Øv, system Y er sårbart - jeg patcher med v2 af patchen - lægger den også på de andre (men glemmer system X)</p>

<p>TL;DR patch af systemer foregår i stort omfang ad-hoc og inventory dækker sjældent alle systemer.</p>

<p>Ovenstående forlænges og strækkes ud når man har mange systemer, kræver servicevinduer, har flere kunder på samme systemer - af mange årsager. Patchning af eksempelvis Heartbleed tager måske totalt set 14 dage wall-clock time og med natarbejde hist og her. Natarbejde betyder så igen at der mangler ressourcer i dagtiden, til næste kriser, og håndtering af kunder der ringer ind med spørgsmål om "denneher nye alvorlige sårbarhed". Jeg lader med vilje være at skrive en specifik, for ofte vil grupper af kunder spørge om tidligere alvorlige sårbarheder, som måske/måske-ikke er løst endnu.</p>

<h2>Pentest og Security Devops</h2>

<p>Vi skal håndtere patchning af systemer løbende, og mere automatisk - udover det vi kan kalde patch management. Patch management dækker efter hvad jeg erfarer nemlig kun en delmængde af systemer, dem som allerede i stort omfang er up-to-date.</p>

<p>Mit forslag, og hvad jeg netop har sagt her til aften, Hej Herning, er at vi skal automatisere mere, OG lære eksempelvis pentest værktøjer at kende.</p>

<p>Ser vi på eksempelvis Heartbleed kommer der hurtigt proof-of-concept programmer og scripts man kan bruge. Hurtigt kommer der også moduler til de værktøjer vi allerede kender - som Nmap, Masscan, Metasploit m.fl. Hvis du kender disse værktøjer og blot skal plugge et nyt lille script ind, a la <a href="http://nmap.org/nsedoc/scripts/ssl-heartbleed.html">http://nmap.org/nsedoc/scripts/ssl-heartbleed.html</a> så kan du mere effektivt bekæmpe dagens brand.</p>

<p>Så mit krav til dig der vil overleve i det ragnarok vi befinder os i er at ændre dine metoder:</p>

<ul><li>Identifikation Brug Nmap og andre pentestværktøjer til at identificere sårbarhederne, scan ukritisk hele din infrastruktur, alle dine IP'er. Sådanne værktøjer er ligeglade med om dine patch management dashboards siger alt er ok, de tester rent faktisk - og hvis du eksempelvis har glemt at genstarte en process efter opdatering fanges det også.</li>
<li>Verifikation Brug automatik som Ansible, Python, Perl, Powershell til at bekræfte/afkræfte thesen om at disse systemer er sårbare, marker disse - kan være 10 ud af 10.000 host, eller 9.999 ud af dine 10.000 systemer, who knows?</li>
<li>Opdatering og workaround - automatisk, der var efter Heartbleed historier om firmaer der havde patchet tusindvis af systemer samme dag! Det er stærkt og noget du skal sigte mod.
NB: husk også at der typisk vil være flere versioner af patches, så du skal sandsynligvis igennem rækken af servere flere gange!</li>
<li>Rinse repeat - og sov indimellem</li>
</ul><p>Du skal forvente at der kommer en ny brand, og derfor skal du hele tiden gå efter at denne cyklus gentages og gennemføres flere gange samme dag måske. Hvert skridt skal altså være optimeret til at tage kort tid, kan gøres gentagne gange - så det udelukker eksempelvis at du hver gang lavet et hjemmelavet script til patch. De rigtige værktøjer og lidt security devops er efter min mening nødvendigt. Specielt værktøjer som kan udvides med "plugins" som små stykker vil være kærkomment.</p>

<p>Det kan hjælpe hvis du bruger både Open Source og kommercielle løsninger, gerne en god symbiose. Du kan ikke altid regne med at den ene eller anden altid er først, faktisk vil jeg sige mere 50/50 for mit vedkommende hvem der først kommer med en hjælpende hånd. Så hvis vi tager udgangspunkt i nogle få værktøjer fra min værktøjskasse vil en process være:</p>

<ul><li><p>Scan med Nmap - kan snildt scanne 20.000 IP'er på 10 minutter med nmap -p 443 --script ssl-heartbleed og vores netværk som input fil
Forudsætter at man allerede har installeret en Kali Linux som flere kan logge ind på, koster en VM med 2 CPU cores, 1024MB mem, 15 Gb disk</p></li>
<li><p>Verificer og opdater med configuration management, jeg er blevet overordentlig glad for Ansible, evt. med output fra foregående step direkte ind!</p></li>
<li><p>Scan med Nmap inkl. næste alvorlige sårbarhed</p></li>
<li><p>Verificer og opdater med Ansible Playbook som nu inkluderer patch nr 2, og eller ændringer til patch nr 1
Ansible har task som byggesten og man kan bede et Ansible run om at skippe tags, eller kun tage bestemte tags - meget fleksibelt</p></li>
<li><p>Detektion er ligeledes et område hvor du gerne skulle kunne afgøre om der er andre systemer du har overset, eller nogen som prøver at udnytte sårbarhederne. Det er specielt her hvor flere værktøjer der overlapper kan være dejligt, både AV der fanger Superfish og IDS der detekterer Superfish vil være relevant.</p></li>
</ul><p>Målet for mig er at alle kan afvikle vores test af dagens sårbarhed, fra eksisterende udstyr, udvide eksisterende løsning til configuration management/patch process - afvikle dette selvstændigt. Altsammen indenfor normal arbejdstid, eller med minimalt natarbejde - måske kun 1 times mistet nattesøvn fremfor 4 timers manuel patch af "for få systemer".</p>

<p>Vel og mærke så I samarbejder, istedet for at en person gentager hele processen for een sårbarhed, så kører I måske 3-4 af disse alvorlige incidents i samme scans, og samme "remediation steps". Så der er måske en som pt. scanner for 3-4 sårbarheder, en som kører configuration management/patch, og en som holder øje med stabiliteten - så alle roller er dækket og alle arbejder effektivt i parallel.</p>

<h2>Del og hersk</h2>

<p>Lad for guds skyld være med at lave din egen Kali Linux, som kun DU har adgang til, lav en delt. Lav ikke specielt script til eeeeen sårbarhed, for imorgen kommer næste patch - brug eksisterende configuration management - det er designet til opgaven og modnet. Hybris hvis du tror du kan slynge noget bedre sammen på ultrakort tid. Lad være med at sidde og holde på kortene, forklar dine kollegaer hvor langt du kom, hvad du gjorde, hvad der mangler - I skal tage over for hinanden, så I får noget søvn allesammen :-)</p>

<p>Der går simpelthen for meget tid med ad-hoc løsninger som kun løser een opgave, hvor jeg ser en fordel i at strømline denne process, for det bliver stadig mere nødvendigt.</p>

<p>Jeg ved ikke om det fremgår tydeligt hvad jeg anbefaler, men så må I skælde mig ud ;-)</p>
  </section></div></body></html>
